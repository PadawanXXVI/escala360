{% extends "base.html" %}
{% block title %}Painel BI ‚Äî Escala360{% endblock %}

{% block content %}
<!-- ============================================================ -->
<!-- üéõÔ∏è Painel de BI Interativo - Escala360 -->
<!-- ============================================================ -->
<section class="text-center mb-4">
  <h1 class="fw-bold text-primary">Painel de BI ‚Äî Escala360</h1>
  <p class="text-muted">An√°lise em tempo real de profissionais, plant√µes e substitui√ß√µes</p>
</section>

<!-- ============================================================ -->
<!-- üîπ Cards dos gr√°ficos -->
<!-- ============================================================ -->
<section class="row g-4">

  <!-- üìä Gr√°fico de Barras - Carga de Plant√µes por Profissional -->
  <article class="col-12 col-md-6 col-lg-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title text-center text-primary">Plant√µes por Profissional</h5>
        <div id="graficoBarras" role="img" aria-label="Gr√°fico de barras mostrando quantidade de plant√µes por profissional"></div>
      </div>
    </div>
  </article>

  <!-- ü•ß Gr√°fico de Pizza - Status das Substitui√ß√µes -->
  <article class="col-12 col-md-6 col-lg-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title text-center text-primary">Status das Substitui√ß√µes</h5>
        <div id="graficoPizza" role="img" aria-label="Gr√°fico de pizza mostrando status das substitui√ß√µes"></div>
      </div>
    </div>
  </article>

  <!-- üìà Gr√°fico de Linha - Plant√µes por Dia -->
  <article class="col-12 col-md-6 col-lg-4">
    <div class="card shadow-sm h-100">
      <div class="card-body">
        <h5 class="card-title text-center text-primary">Plant√µes por Dia</h5>
        <div id="graficoLinha" role="img" aria-label="Gr√°fico de linha mostrando quantidade de plant√µes por dia"></div>
      </div>
    </div>
  </article>
</section>
{% endblock %}


{% block scripts %}
<!-- ============================================================ -->
<!-- üìä Scripts dos gr√°ficos Plotly.js -->
<!-- ============================================================ -->
<script>
  // ===============================
  // üì¶ Dados vindos do Flask (convertidos via Jinja)
  // ===============================
  const cargaLabels = {{ carga_labels | tojson }};
  const cargaValues = {{ carga_values | tojson }};

  const pizzaLabels = {{ pizza_labels | tojson }};
  const pizzaValues = {{ pizza_values | tojson }};

  const linhaLabels = {{ linha_labels | tojson }};
  const linhaValues = {{ linha_values | tojson }};

  // ===============================
  // üìä Gr√°fico de Barras ‚Äî Plant√µes por Profissional
  // ===============================
  if (cargaLabels.length > 0 && cargaValues.length > 0) {
    const traceBarras = {
      x: cargaLabels,
      y: cargaValues,
      type: 'bar',
      marker: { color: '#0d6efd' },
    };

    const layoutBarras = {
      margin: { t: 40, l: 60, r: 20, b: 100 },
      title: { text: 'Plant√µes por Profissional', font: { size: 16 } },
      xaxis: { tickangle: -45 },
      yaxis: { title: 'Total de Plant√µes' },
      responsive: true,
    };

    Plotly.newPlot('graficoBarras', [traceBarras], layoutBarras, { responsive: true });
  } else {
    document.getElementById('graficoBarras').innerHTML = '<p class="text-muted text-center mt-4">Sem dados dispon√≠veis.</p>';
  }

  // ===============================
  // ü•ß Gr√°fico de Pizza ‚Äî Status das Substitui√ß√µes
  // ===============================
  if (pizzaLabels.length > 0 && pizzaValues.length > 0) {
    const tracePizza = {
      labels: pizzaLabels,
      values: pizzaValues,
      type: 'pie',
      textinfo: 'label+percent',
      marker: {
        colors: ['#0d6efd', '#198754', '#ffc107', '#dc3545'],
      },
    };

    const layoutPizza = {
      margin: { t: 40, l: 20, r: 20, b: 20 },
      title: { text: 'Status das Substitui√ß√µes', font: { size: 16 } },
      responsive: true,
    };

    Plotly.newPlot('graficoPizza', [tracePizza], layoutPizza, { responsive: true });
  } else {
    document.getElementById('graficoPizza').innerHTML = '<p class="text-muted text-center mt-4">Sem dados dispon√≠veis.</p>';
  }

  // ===============================
  // üìà Gr√°fico de Linha ‚Äî Plant√µes por Dia
  // ===============================
  if (linhaLabels.length > 0 && linhaValues.length > 0) {
    const traceLinha = {
      x: linhaLabels,
      y: linhaValues,
      mode: 'lines+markers',
      line: { color: '#198754', width: 3 },
      marker: { size: 6 },
    };

    const layoutLinha = {
      margin: { t: 40, l: 60, r: 20, b: 60 },
      title: { text: 'Plant√µes por Dia', font: { size: 16 } },
      xaxis: { title: 'Data' },
      yaxis: { title: 'Total de Plant√µes' },
      responsive: true,
    };

    Plotly.newPlot('graficoLinha', [traceLinha], layoutLinha, { responsive: true });
  } else {
    document.getElementById('graficoLinha').innerHTML = '<p class="text-muted text-center mt-4">Sem dados dispon√≠veis.</p>';
  }
</script>
{% endblock %}
